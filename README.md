# v2rayUsrMgr
این اسکریپت یک برنامه (Bash Script) برای مدیریت آسان یوزرها در یک سرور v2ray است که توسط آن می‌توانید کاربرها را مدیریت کنید. پیش از استفاده از این برنامه باید v2ray را روی سرور لینوکس خود نصب کرده باشید. راحت ترین راه برای نصب یک سرور v2ray استفاده از اسکریپت آماده در ریپوزیتوری v2fly است که می‌توانید در این آدرس آن را بیابید:
https://github.com/v2fly/fhs-install-v2ray


# نصب و راه اندازی اسکریپت
ابتدا این ریپوزیتوری را در روی سرور خود clone کنید:
```bash
$ git clone https://github.com/3uffer/v2rayUsrMgr
```
حالا به فولدر پروژه بروید:
```bash
$ cd v2rayUsrMgr
```
پس از نصب v2ray لازم است سرویس کانفیگ شود. در این فولدر یک فایل config.json نمونه وجود دارد که بر اساس متد websocket سرور v2ray را روی پورت 80 پیکربندی می‌کند. همچنین فایل نمونه کانفیگ client.json نیز برای این پیکربندی در همین ریپوزیتوری قرار داده شده. فایل config.json را در صورت نیاز ویرایش کنید و سپس آن را در فولدر زیر روی سرور کپی کنید:
```bash
$ cp ./config.json /usr/local/etc/v2ray/
```
سپس فایل client.json را که قالب کانفیگ کلاینت‌ها است ویرایش کنید و در همین فولدری که هستید ذخیره کنید. توجه داشته باشید که حتما باید خط 18 که نشانی ip سرور باید در آنجا نوشته شود را ویرایش کنید و بجای "server ip" حتما باید نشانی ip سرور خودتان را بنویسید.


سپس مشابه دستور زیر پرمیشن اجرا برای usrmgr.sh را فعال کنید:

```bash
$ chmod 777 usrmgr.sh
```
این اسکریپت برای اجرا به پکیج jq نیاز دارد. برای نصب این پکیج بصورت زیر عمل کنید:
```bash
$ apt update
$ apt install jq
```

اکنون اسکریپت آماده اجرا است. کافیست آن را بدون هیچ پارامتری اجرا کنید تا فهرست دستورات را به شما نشان دهد:
```bash
$ ./usrmgr.sh
```
# دستورها
## افزودن کاربر جدید:
برای افزودن کاربر جدید کافی است که دستور add را بصورت زیر اجرا کنید. پس از اجرا کانفیگ لازم برای کلاینت به شما نمایش داده می‌شود که می‌توانید با ارسال آن به کاربر مورد نظر از او بخواهید در برنامه کلاینت خود آن را کپی کند و به سرور متصل شود. بجای user1 نام مورد نظر خودتان را برای هر کاربر بنویسید.
```bash
$ ./usrmgr.sh add user1
```
## حذف کاربر:
برای حذف یک کاربر به روش زیر عمل کنید. بجای user1 نام کاربر مورد نظر را بنویسید.
```bash
$ ./usrmgr.sh del user1
```
## نمایش کانفیگ برای هر کاربر:
اگر به هر دلیل هنگام ساخت کاربر کانفیگ را کپی نکرده باشید، توسط این دستور می‌توانید برای یک کاربر که قبلا ایجاد شده، کانفیگ را مجدد دریافت کنید.
```bash
$ ./usrmgr.sh cfg user1
```
## فهرست کاربرهای موجود:
برنای دریافت فهرست کاربرها دستور ls را به روش زیر اجرا کنید:
```bash
$ ./usrmgr.sh ls
```
## نمایش وضعیت دانلود/آپلود کاربران:
اگر آمار دانلود/آپلود را هنگام نصب v2ray فعال کرده باشید با دستور زیر می‌توایند آمار را تماشا کنید. در ورژن فعلی v2ray پس از هر بار restart شدن سرویس v2ray آمار نیز ریست می‌شود.
```bash
$ ./usrmgr.sh stat
```
دستور فوق در واقع یک میانبر است که معادل دستور زیر عمل می‌کند:
```bash
$ v2ray api stats --server=127.0.0.1:10085
```
توجه داشته باشید که اگر در تنظیمات آمار v2ray شماره پورت چیزی بجز 10085 باشد یا ip بجز 127.0.0.1 انتخاب شده باشد، باید خط 131 در فایل usrmgr.sh را خودتان ویرایش کنید تا این دستور میانبر درست کار کند.
## راه اندازی مجدد سرویس v2ray:
در حال حاضر پس از ایجاد یا حذف کاربر، برای اینکه تغییرات در کانفیگ سرور v2ray اعمال شود، حتما باید v2ray.service یک بار راه اندازی مجدد شود. با این دستور می‌توانید سرویس را راه اندازی مجدد کنید.
```bash
$ ./usrmgr.sh restart
```
توجه داشته باشید که این دستور در واقع یک میانبر است که معادل اجرای دستور زیر در ترمینال سرور عمل می‌کند:
```bash
$ systemctl restart v2ray.service
```